<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Experimental Assignment - 2: Experimental Robotics Laboratory - Assignment 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Experimental Assignment - 2<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Experimental Robotics Laboratory - Assignment 2 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The goal of this assignment is to develop a software architecture able to simulate an autonomous Cluedo game. In particular the robot has to explore an environment looking for hints that are generated in established locations. These locations can be reached via the robotic arm provided by the model of the robot used. In order to control the arm and reach the hints, a dedicated <code>moveit_assignment</code> package has been developed. As soon as the robot is ready to make an hypothesis, it moves towards the center of the environment, asking to the oracle if the considered hypothesis is correct or not. The behaviour of the robot is based on a planning system, since the robot's actions are selected through a <code>PDDL</code> planning system.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Compatibility</h1>
<p >The project is developed using the provided docker container. In the event that it is not possible to test the project on this image, it is also possible to use ROS Noetic on Ubuntu 20.04.2, after installing the ARMOR and Moveit components on this operating system. In any case, the project is compatible with ROS Noetic, and consequently may not work using a different ROS distribution.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Description of the package</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Robot behaviour and ROSPlan architecture</h2>
<p >Referring to the main purpose of the project, the robot should perform the following actions:</p>
<ol type="1">
<li>move around the aforementioned environment</li>
<li>move its arm in order to reach the established locations</li>
<li>perceive an hint as soon as it has reached the established location</li>
<li>check the consistency of an hypothesis</li>
<li>check if an hypothesis is correct</li>
</ol>
<p >Each one of the above actions refer to a specific robot's state. The order in which these actions should be performed corresponds to the plan generated by the ROSPlan system. Referring to this system, the dispatcher is addressed to perform transitions between different states. To these states it is possible to add:</p><ul>
<li>an initial state of the robot</li>
<li>an announce state, which is strictly related to the check correct state</li>
</ul>
<p >All these states are connected through a reasoning module, that implements ROSPlan. In the <code>common</code> folder it is possible to find the defined <code>PDDL</code> <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/common/cluedo_domain_nohint.pddl">domain</a> and the relative <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/common/cluedo_problem_nohint.pddl">problem</a>. In the domain file, the following types have been defined:</p>
<ul>
<li>robot</li>
<li>location</li>
<li>hypothesis</li>
</ul>
<p >On top, here each state of the robot corresponds to a durative action that has to be accomplished:</p>
<ul>
<li>move</li>
<li>move_gripper</li>
<li>perceive_hint</li>
<li>check_consistency</li>
<li>check_correct</li>
<li>new_turn (action used to make the robot visit again all the waypoints after that a turn of navigation has been completed)</li>
</ul>
<p >These durative actions are used to manage the following predicates:</p>
<ul>
<li>visited (and non_visited), used to manage the navigation</li>
<li>not_initial_location, used to differentiate the initial location and the waypoints</li>
<li>at, used to state the actual location</li>
<li>move_performed, used to move the robot's arm when it has reached a location</li>
<li>gripper_positioned (and not_gripper_positioned), used to state the gripper has (not) moved correctly and the hint can (cannot) be perceived</li>
<li>perceived, used to state if an hypothesis has been perceived</li>
<li>consistent, used to state if a consistent hypothesis has been found</li>
<li>end_game, used to state that a correct hypothesis has been found and the game is ended</li>
</ul>
<p >The related problem file, instead, initialize the robot at the center of the environment, and all the waypoints are set as non_visited. The goal of the problem is to have the predicate end_game as true, i.e., that a correct hypothesis has been found.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
ROS Nodes</h2>
<p >The nodes are identifiable through the files inside the <code>src</code> and the <code>scripts</code> folder, and so we have:</p>
<ul>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/ArmorInterface.py">ArmorInterface.py</a>, a service node that interacts with ARMOR in different ways: load the ontology; add a new hint to the ontology; check that an hypothesis is consistent; check that an hypothesis is correct</li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/AnnounceHypotesis.py">AnnounceHypotesis.py</a>, a service node used for the announcement of the robot: once the robot has found a consistent hypothesis, the robot moves toward the center of the environment and announce it to the oracle</li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/Reasoning.py">Reasoning.py</a>, the node that manages the entire simulation: first of all, it asks to the <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/ArmorInterface.py">ArmorInterface.py</a> to load the ontology; then the first phase of the game is started; since the game is not ended it interfaces with the ROSPlan system, recalling the problem loader, the plan generator, the parse planning service and the dispatcher to dispatch the actions</li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/simulation.cpp">simulation.cpp</a>, a node to position randomly the locations where hints are perceived; on top it generates hints randomly and publish them on the <code>oracle_hint</code> topic. These hints can be correctly perceived or malformed by the <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/ArmorInterface.py">ArmorInterface.py</a>. Moreover the oracle responds if the hypothesis to check is correct or not.</li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/initial_phase.cpp">initial_phase.cpp</a>, a service node used to simulate the initial phase of the game</li>
</ul>
<p >The actions called by the dispatcher are implemented as classes, defined in the <code>include/my_erl2</code> folder. In the following it is possible to find the implemented actions:</p>
<ul>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/move.cpp">move.cpp</a> implements the action devoted to the motion of the robot, that relies on this <a href="https://github.com/CarmineD8/rt2_packages/blob/main/motion_plan/scripts/go_to_point_action.py">script</a></li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/grippermotion.cpp">grippermotion.cpp</a> implements the action to move the robotic arm: in order to reach a certain location in the environment, the plan and the motion of the robotic arm is directly managed by moveit through the packege <code>moveit_assignment</code></li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/perceivehints.cpp">perceivehints.cpp</a>, <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/checkconsistency.cpp">checkconsistency.cpp</a> and <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/src/checkcorrect.cpp">checkcorrect.cpp</a> are three action nodes that simply recall the <a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/scripts/ArmorInterface.py">ArmorInterface.py</a> script respectively to perceive a new hint, check if there is a new consistent hypothesis, check if the current consistent hypothesis is correct.</li>
</ul>
<p >Instead the services are:</p>
<ul>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/srv/ArmorInterface.srv">ArmorInterface.srv</a>, which has as request the mode that the client wants in order to interact with ARMOR (0 to load ontology, 1 to check correct, 2 to check consistency, 3 to perceive an hint) and the ID of the hypothesis to be checked. The response is composed by the same mode and ID in addition to a success field, which is true if the action has been accomplished correctly.</li>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/srv/Announcement.srv">Announcement.srv</a>, which has as request an hypothesis (composed of [who, what, where]), while the response is a boolean to state that the action has been completed correctly.</li>
</ul>
<p >Finally the message is:</p>
<ul>
<li><a href="https://github.com/RiccardoZuppetti/exprob_ass2/blob/main/my_erl2/msg/ErlOracle.msg">ErlOracle.msg</a>, which is used to store a perceived hint</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
States diagram</h2>
<p ><img src="https://user-images.githubusercontent.com/89387809/199301019-a5bef028-9fc5-477d-8fd3-ea43ac0476e9.jpg" alt="states" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md6"></a>
UML diagram</h2>
<p ><img src="https://user-images.githubusercontent.com/89387809/199231588-3ade1cd1-e29a-4c11-b00a-0faf38fe634a.jpg" alt="UML_2" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Rqt-graph</h2>
<p ><img src="https://user-images.githubusercontent.com/89387809/199276290-dde7ac8b-ea2f-4122-b9fe-79df435cab74.png" alt="rqt_graph" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md8"></a>
How to Run</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Requirements</h2>
<p >In order to compile this project, the following ROS packages are needed:</p>
<ul>
<li><a href="https://github.com/EmaroLab/armor">armor</a></li>
<li><a href="https://github.com/CarmineD8/rt2_packages/tree/main/motion_plan">motion_plan</a></li>
<li><a href="https://github.com/KCL-Planning/ROSPlan">ROSPlan</a></li>
</ul>
<p >Then, in order to install Moveit, follow this <a href="https://github.com/RiccardoZuppetti/move_it_installation/blob/main/instr.txt">guide</a>.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
How to compile the code</h2>
<p >Move to your <code>catkin_ws/src/armor/armor</code> folder and digit (only the first time):</p>
<div class="fragment"><div class="line">./gradlew deployApp</div>
</div><!-- fragment --><p >Then, move to your <code>catkin_ws/src</code> folder and clone this repository:</p>
<div class="fragment"><div class="line">git clone https://github.com/RiccardoZuppetti/exprob_ass2.git experimental_assignment2</div>
</div><!-- fragment --><p >and build the workspace with the following command:</p>
<div class="fragment"><div class="line">catkin_make</div>
</div><!-- fragment --><p >In case you get errors about missing packages, proceed with the installation of those packages by typing:</p>
<div class="fragment"><div class="line">apt-get install ros-noetic-&lt;missing_package&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
Description of the execution</h2>
<p >To launch the project it is needed to open four shells.</p>
<p >In the first shell, digit:</p>
<div class="fragment"><div class="line">roscore &amp;</div>
</div><!-- fragment --><p >and then</p>
<div class="fragment"><div class="line">rosrun armor execute it.emarolab.armor.ARMORMainService</div>
</div><!-- fragment --><p >In the second one digit:</p>
<div class="fragment"><div class="line">roslaunch moveit_assignment gazebo_launcher.launch 2&gt;/dev/null</div>
</div><!-- fragment --><p >In the third terminal digit the following command:</p>
<div class="fragment"><div class="line">roslaunch my_erl2 pddl_launcher.launch 2&gt;/dev/null</div>
</div><!-- fragment --><p >Finally, in the last shell digit:</p>
<div class="fragment"><div class="line">roslaunch my_erl2 game_launcher.launch 2&gt;/dev/null</div>
</div><!-- fragment --><p >In the following it is possible to observe several screenshots that refer to the execution of the project.</p>
<p ><img src="https://user-images.githubusercontent.com/89387809/199282915-1e671015-e592-46e6-8045-49db664713a6.png" alt="shell_1" width="1399" class="inline"/></p>
<p ><img src="https://user-images.githubusercontent.com/89387809/199282922-17cd091d-009d-428c-be0f-4206fd72d205.png" alt="shell_2" width="1402" class="inline"/></p>
<p ><img src="https://user-images.githubusercontent.com/89387809/199282931-c8d6a75b-c1c7-486f-8843-438a218bf6ba.png" alt="shell_3" width="1403" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md12"></a>
Working hypothesis and environment</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
System's features</h2>
<p >The system is characterized by a modular architecture, since each component has a specific role in the architecture.</p>
<p >As can be seen in the nodes, services and actions are the communication protocols used. This means that most of the declared modules are sincronized with the others.</p>
<p >The ontology is the core of the whole game. It allows to reason about hypotesis. The hypothesis are make of hints. Hints can belong to three different classes: PERSON, PLACE and WEAPON. The perceived hints as ErlOracle message are the A-box of these concepts. The hypotesis belong to the COMPLETE class if they has at least one PERSON, one WEAPON and one PLACE, while they belong also to the INCONSISTENT class if they have more than one PERSON or PLACE or WEAPON. Consequently the consistent hypotesis are the ones that has only one entity for each hint class and they are the ones which belong to the COMPLETE class and not to the INCOSISTENT one. The INCORRECT class, instead, has as instances all the hypothesis already checked as not-correct.</p>
<p >The ROSPlan system manages the whole simulation. This firstly works as PDDL planning system which generate a plan in order to reach the goal in the optimal way. ROSPlan is basically the interface between the PDDL file and ROS. This allows to syncronize the PDDL problem, the execution of the PDDL's durative actions and the corresponding actions in ROS. ROSPlan guarantee optimal performances with respect to a simple finite state machine.</p>
<p >The robotic arm is controlled by moveit, that directly compute the inverse kinematic, find the optimal plan with RRT to reach a certain goal and execute it.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
System's limitations</h2>
<p >Regarding the navigation module is not possible to control the yaw of the robot, since in the <code>go_to_point_action.py</code> script the final yaw is always zero with respect to the segment that goes from the starting location to the final one. So if the robot goes directly in two adjacent verteces of the environment the final yaw not always allows to perceive the hint. This issue has been overcomed making sure that the robot always returns in the (0, 0) position.</p>
<p >After a certain number of iterations the arm does not reach the goal posistion and remains stopped even if the related action concludes correctly. In order to not make impact this behavior, a control is done on the perceived hints. If the same hint has been perceived twice that means that the arm does not move and consequently the related action fails.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
System's technical improvements</h2>
<p >Referring to the above issue of the yaw during the navigation, the desired yaw in the <code>go_to_point_action.py</code> script must be modified, or another navigation planning system can be used, such as move base.</p>
<p >An improvement can be done on the robot model, since the robot has been done primitives shapes with only the strigtly needed requirements.</p>
<p >Since the initial phase, which is responsible of load the ontology and explore the environment, is not managed through ROSPlan, a possible solution is to add a specific durative-action on the domain file. A predicate which is grounded only once the action is concluded and this predicate should be added as precondition of all other actions. Logically the ROS Plan will be adapted consequently.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Author and contacts</h1>
<p >Author: Riccardo Zuppetti</p>
<p >Contacts: <a href="#" onclick="location.href='mai'+'lto:'+'ric'+'ca'+'rdo'+'.z'+'upp'+'et'+'ti@'+'ic'+'lou'+'d.'+'com'; return false;">ricca<span style="display: none;">.nosp@m.</span>rdo.<span style="display: none;">.nosp@m.</span>zuppe<span style="display: none;">.nosp@m.</span>tti@<span style="display: none;">.nosp@m.</span>iclou<span style="display: none;">.nosp@m.</span>d.co<span style="display: none;">.nosp@m.</span>m</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
